+++
read_time = 5
date = "2018-01-05"
title = "基于mock 的前后端分离开发流程详解"
tags = ["mock"]
categories = ["general"]
draft = false
description = "提升团队开发效率的工作方式。"
weight = 99
+++

阅读人群：团队负责人  
您将收获：一种新的开发流程，减少团队的沟通成本和增加项目的质量。


## 前言

在计算机高速发展的今天，企业在人力沟通成本上的消耗大大增加。起因是现今的软件架构越来越复杂，对互联网从业者要求越来越高，如何行之有效的提高软件开发的质量是企业绕不过的坎，在这之中需要更多的尝试以求达到一个减少人力沟通成本提高效率的现代软件开发方式。


## 为什么需要Mock？

在学习编程之初我们常常编写独立的java类，但实际软件开发中我们常常需要编写充满依赖关系的类，如下图所示：  
![image](https://i.imgur.com/tmrcw6q.png)  
这是一个比较常见的三层架构，上层依赖下层。针对这种依赖关系我们需要编写单元测试，来测试每一层中每一个方法中的代码是否正常工作。然后在去测试依赖关系正常与否，在两者都正常的情况下我们可以判定功能能正常工作。但实际开发中我们需要协同前端一起完成应用的快速开发，而前端需要后端提供良好且健壮的API来完成应用的视觉呈现。在这一情况下我们需要mock来替代每一层级的预期结果，来降低时间成本，同时也提高了程序的可用性。总的来说Mock是为了解决units之间由于耦合而难于被测试的问题。所以mock object是unit test的一部分。


## Mock的好处是什么?

- **提前创建测试，TDD（测试驱动开发）**  
    这是个最大的好处吧。如果你创建了一个Mock那么你就可以在service接口创建之前写Service Tests了，这样你就能在开发过程中把测试添加到你的自动化测试环境中了。换句话说，模拟使你能够使用测试驱动开发。

- **团队可以并行工作**  
    这类似于上面的那点；为不存在的代码创建测试。但前面讲的是开发人员编写测试程序，这里说的是测试团队来创建。当还没有任何东西要测的时候测试团队如何来创建测试呢？模拟并针对模拟测试！这意味着当service借口需要测试时，实际上QA团队已经有了一套完整的测试组件；没有出现一个团队等待另一个团队完成的情况。这使得模拟的效益型尤为突出了。

- **你可以创建一个验证或者演示程序**  
    由于Mocks非常高效，Mocks可以用来创建一个概念证明，作为一个示意图，或者作为一个你正考虑构建项目的演示程序。这为你决定项目接下来是否要进行提供了有力的基础，但最重要的还是提供了实际的设计决策。    

- **为无法访问的资源编写测试**  
    这个好处不属于实际效益的一种，而是作为一个必要时的“救生圈”。有没有遇到这样的情况？当你想要测试一个service接口，但service需要经过防火墙访问，防火墙不能为你打开或者你需要认证才能访问。遇到这样情况时，你可以在你能访问的地方使用MockService替代，这就是一个“救生圈”功能。

- **Mock 可以交给用户**  
    在有些情况下，某种原因你需要允许一些外部来源访问你的测试系统，像合作伙伴或者客户。这些原因导致别人也可以访问你的敏感信息，而你或许只是想允许访问部分测试环境。在这种情况下，如何向合作伙伴或者客户提供一个测试系统来开发或者做测试呢？最简单的就是提供一个mock，无论是来自于你的网络或者客户的网络。soapUI mock非常容易配置，他可以运行在soapUI或者作为一个war包发布到你的java服务器里面。

- **隔离系统**  
    有时，你希望在没有系统其他部分的影响下测试系统单独的一部分。由于其他系统部分会给测试数据造成干扰，影响根据数据收集得到的测试结论。使用mock你可以移除掉除了需要测试部分的系统依赖的模拟。当隔离这些mocks后，mocks就变得非常简单可靠，快速可预见。这为你提供了一个移除了随机行为，有重复模式并且可以监控特殊系统的测试环境。


## 基于Mock的角色开发流程定义

**（1） 角色职责**

- UI  
    负责原型图的制作，视觉设计开发
    
- 前端  
    负责页面展现的接口设计，功能页面的开发。 并最终提交相对完整的功能给到测试工程师。

- 后端   
    负责后端功能模块的实现和前端一起定义接口并实现。
    
- 测试  
    负责衔接前端和间接后端团队。
    

**（2）开发流程**  
![image](https://i.imgur.com/DPdBwYz.png)

如上图所示，定义出了3个团队在基于mock方式工作内容改动最大的角色。其中最需要关注的是各个团队相互衔接的部分。

**编写单元测试**  
后端团队  
考虑到公司测试团队主要进行的是前端结果测试，固在后端的环节中测试工作将由后端开发完成。  

**后端接口对接**  
后端团队 -> 前端团队  
测试团队验收完接口后，可以移交给前端团队进行页面级别的接口接入。  

**提交功能测试**  
前端团队 -> 测试团队  
前端团队完成了产品的包括页面及接口上对接的工作后，就可以提交给测试团队进行最终的功能页面验收了。  

开发流程中，每一个涉及到多方分工协作的环节，都会产生一些约定俗成的文档输出。 

---
**# 过程性文档**

- **接口契约文档**  
    用于定义前端与后端之间的接口定义  
    **责任方**：前端团队  
    第一个版本的接口契约定义，一定是由前端出的。这里之所以第一版由前端出是有原因的，因为前端是基于UI输出的视觉设计来考虑的，而后端是基于结构化实体对象来考虑的。  
    **评审方**
    后端团队，测试团队，项目负责人

- **接口测试用例文档**  
    用于定义验收接口的用例  
    **责任方**: 测试团队  
    **评审方**: 后端团队，项目负责人

- **功能测试用例文档**  
    用于定义验收接口的用例  
    **责任方**: 测试团队  
    **评审方**: 前端团队，项目负责人

- **单元测试用例文档**  
    用于定义验收接口的用例  
    **责任方**: 后端团队  
    **评审方**: 后端团队，项目负责人  


## Mock使用示例 

**前端**   
- Javascript **mock.js**

**后端**
- Java **Mockito** 





[前后端mock使用示例](https://github.com/bugjc/mock-demo)

## 总结

模拟对象的概念就是我们想要创建一个可以替代实际对象的对象。这个模拟对象要可以通过特定参数调用特定的方法，并且能返回预期结果。


## 参考资料

- [一次前后端分离实践](https://www.juhe.cn/news/index/id/2185)
- [Mockito：一个强大的用于Java开发的模拟测试框架](http://blog.csdn.net/zhoudaxia/article/details/33056093)
    
- [5分钟了解Mockito](http://liuzhijun.iteye.com/blog/1512780)
- [mock.js官网](http://mockjs.com/)



